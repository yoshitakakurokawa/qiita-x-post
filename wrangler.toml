name = "qiita-x-bot"
main = "src/index.ts"
compatibility_date = "2025-01-07"

# Cron Triggers
# 月・木 9:00 に記事投稿
# 毎日 2:00 にメトリクス更新
[triggers]
crons = [
  "0 9 * * 1,4",  # 記事投稿: 月曜・木曜 9:00 (JST)
  "0 2 * * *"     # メトリクス更新: 毎日 2:00 (JST)
]

# Workers AI binding
[ai]
binding = "AI"

# KV namespace for caching
[[kv_namespaces]]
binding = "KV"
id = "f9cbb9a9f22a461c8ff1bc096ad0d2ab"  # wrangler kv:namespace create KV で作成

# D1 database for metrics
[[d1_databases]]
binding = "DB"
database_name = "qiita-bot-db"
database_id = "caafc37f-e7c6-4822-aa40-007f7fd900ce"  # wrangler d1 create qiita-bot-db で作成

# Vectorize for article embeddings
[[vectorize]]
binding = "VECTORIZE"
index_name = "article-embeddings"

# Environment variables (non-secret)
[vars]
ORG_MEMBERS = "c_nit,wakuto_kurokawa,wakuto-KK,wakuto-o-ga,wakuto_m-n,voo,hato_code,k3black,wakuto-ariga-owl"  # 組織メンバーのQiita ID（カンマ区切り）
DEFAULT_SCORE_THRESHOLD = "25"  # メタスコアの閾値

[observability]
[observability.logs]
enabled = false
head_sampling_rate = 1
invocation_logs = true
persist = true
